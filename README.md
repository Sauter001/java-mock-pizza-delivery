# 미션 - 피자 주문

## 🔍 진행 방식

- 미션은 **기능 요구 사항, 프로그래밍 요구 사항, 과제 진행 요구 사항** 세 가지로 구성되어 있다.
- 세 개의 요구 사항을 만족하기 위해 노력한다. 특히 기능을 구현하기 전에 기능 목록을 만들고, 기능 단위로 커밋 하는 방식으로 진행한다.
- 기능 요구 사항에 기재되지 않은 내용은 스스로 판단하여 구현한다.

## 🚨 과제 제출 전 체크 리스트 - 0점 방지

- 기능 구현을 모두 정상적으로 했더라도 **요구 사항에 명시된 출력값 형식을 지키지 않을 경우 0점으로 처리**한다.
- 기능 구현을 완료한 뒤 아래 가이드에 따라 테스트를 실행했을 때 모든 테스트가 성공하는지 확인한다.
- **테스트가 실패할 경우 0점으로 처리**되므로, 반드시 확인 후 제출한다.

### 테스트 실행 가이드

- 터미널에서 `java -version`을 실행하여 Java 버전이 21인지 확인한다. Eclipse 또는 IntelliJ IDEA와 같은 IDE에서 Java 21로 실행되는지 확인한다.
- 터미널에서 Mac 또는 Linux 사용자의 경우 `./gradlew clean test` 명령을 실행하고, Windows 사용자의 경우 `gradlew.bat clean test` 또는 `.\gradlew.bat clean test` 명령을 실행할 때 모든 테스트가 아래와 같이 통과하는지 확인한다.

```
BUILD SUCCESSFUL in 0s
```

---

## 🚀 기능 요구 사항

### 우아한 피자 배달 주문 시스템

우아한 피자는 잠실역 인근에서 10년째 운영 중인 피자 전문점입니다. 최근 배달 주문량이 급증하면서 기존의 전화 주문 방식으로는 더 이상 주문을 효율적으로 처리하기 어려워졌습니다.

지난달에는 주문 폭주로 인해 여러 가지 문제가 발생했습니다. 전화로 받은 주문의 옵션을 잘못 기록하여 고객 불만이 접수되었고, 쿠폰 할인 금액을 계산하는 과정에서 실수가 발생하여 손해를 보기도 했습니다. 

특히 바쁜 저녁 시간대에는 배달비 무료 조건을 놓쳐 고객에게 추가 요금을 청구하는 실수도 있었습니다.
또한, 피자는 사이즈(M, L, XL)와 토핑 추가 옵션이 있어 가격 계산이 복잡합니다. 직원들이 암산으로 계산하다 보니 오류가 잦았고, 신입 직원의 경우 메뉴와 옵션을 외우는 데만 일주일 이상이 걸렸습니다.

따라서 2024년 12월부터 온라인 배달 주문 시스템을 도입하여 주문 과정을 자동화하기로 하였습니다. 이 시스템은 고객이 직접 사용하게 됩니다. 

#### 주문 시스템의 목표

* 정확한 가격 계산: 메뉴 기본가 + 옵션 추가금 + 배달비 - 쿠폰 할인을 자동 계산 
* 옵션 선택 가이드: 필수 옵션(사이즈)과 선택 옵션(토핑, 소스)을 명확히 구분 
* 쿠폰 적용 자동화: 최소 주문 금액 조건을 자동 검증 
* 주문 실수 방지: 최소 주문 금액 미달 시 주문 차단
---

### 메뉴 구성
- 메뉴는 `피자`, `사이드`, `음료` 세 가지 카테고리로 구성된다.
- 각 메뉴는 고유한 메뉴 코드, 이름, 기본 가격을 가진다.

### 옵션 시스템
- 메뉴에는 **필수 옵션**과 **선택 옵션**이 있다.
- 필수 옵션은 반드시 하나를 선택해야 주문이 가능하다.
- 선택 옵션은 0개 이상 선택할 수 있으며, 중복 선택이 가능하다.
- 옵션에는 추가 금액이 있을 수 있다.

### 쿠폰 시스템
- 쿠폰은 `정액 할인`, `정률 할인`, `배달비 무료` 세 가지 종류가 있다.
- 각 쿠폰에는 **최소 주문 금액 조건**이 있다.
- 주문당 쿠폰은 **1개만** 적용할 수 있다.

### 배달비
- 기본 배달비는 3,000원이다.
- 주문 금액이 20,000원 이상이면 배달비가 무료이다.
- 배달비 무료 쿠폰 사용 시에도 배달비가 무료이다.

---

### 기능 요구 사항

#### 1. 데이터 로드
- 프로그램 시작 시 `src/main/resources/menus.md`에서 메뉴 목록을 불러온다.
- 프로그램 시작 시 `src/main/resources/options.md`에서 옵션 목록을 불러온다.
- 프로그램 시작 시 `src/main/resources/coupons.md`에서 보유 쿠폰 목록을 불러온다.

#### 2. 메뉴 조회
- 카테고리별로 메뉴 목록을 출력한다.
- 각 메뉴의 이름, 기본 가격, 필수 옵션 여부를 함께 표시한다.

#### 3. 메뉴 주문
- 메뉴 코드와 수량을 입력받아 장바구니에 추가한다.
- 필수 옵션이 있는 메뉴는 옵션을 선택해야 한다.
- 선택 옵션은 추가로 선택할 수 있다.
- 같은 메뉴라도 옵션이 다르면 별도 항목으로 장바구니에 추가된다.
- 같은 메뉴와 같은 옵션이면 수량이 합산된다.

#### 4. 장바구니 관리
- 장바구니에 담긴 메뉴 목록을 조회한다.
- 장바구니에서 특정 항목을 삭제할 수 있다.
- 장바구니에서 특정 항목의 수량을 변경할 수 있다.
- 수량을 0으로 변경하면 해당 항목이 삭제된다.

#### 5. 쿠폰 적용
- 보유한 쿠폰 목록을 조회한다.
- 쿠폰을 선택하여 적용한다.
- 쿠폰 적용 조건
  - 최소 주문 금액을 충족해야 적용 가능하다.
  - 이미 적용된 쿠폰이 있으면 기존 쿠폰이 해제되고 새 쿠폰이 적용된다.
- 적용된 쿠폰을 해제할 수 있다.

#### 6. 주문 금액 계산
- **메뉴 금액**: (기본 가격 + 옵션 추가 금액) × 수량
- **총 주문 금액**: 모든 메뉴 금액의 합계
- **할인 금액**: 쿠폰에 의한 할인 금액
  - 정액 할인: 쿠폰에 명시된 금액
  - 정률 할인: 총 주문 금액 × 할인율 (100원 단위 절삭)
- **배달비**: 
  - 총 주문 금액 20,000원 이상 또는 배달비 무료 쿠폰 적용 시: 0원
  - 그 외: 3,000원
- **최종 결제 금액**: 총 주문 금액 - 할인 금액 + 배달비

#### 7. 주문 완료
- 최종 결제 금액이 **최소 주문 금액(12,000원)** 이상이어야 주문이 가능하다.
- 주문 완료 시 주문 내역서를 출력한다.
- 주문 완료 시 예상 도착 시간을 출력한다.
  - 예상 도착 시간: 현재 시간 + 30~50분 (랜덤)
- 사용한 쿠폰은 보유 목록에서 삭제된다.

---

### 예외 처리

- 사용자가 잘못된 값을 입력할 경우 `IllegalArgumentException`를 발생시키고, "[ERROR]"로 시작하는 에러 메시지를 출력 후 해당 부분부터 입력을 다시 받는다.
  - `Exception`이 아닌 `IllegalArgumentException`, `IllegalStateException` 등과 같은 명확한 유형을 처리한다.

---

## 💾 사전 제공 정보

### 메뉴 목록 (src/main/resources/menus.md)

```
메뉴코드,카테고리,메뉴명,기본가격,필수옵션그룹
PZ001,피자,페퍼로니 피자,15000,사이즈
PZ002,피자,치즈 피자,13000,사이즈
PZ003,피자,불고기 피자,16000,사이즈
PZ004,피자,슈프림 피자,18000,사이즈
PZ005,피자,하와이안 피자,16000,사이즈
SD001,사이드,치즈스틱,5000,
SD002,사이드,감자튀김,4000,
SD003,사이드,치킨윙,6000,
SD004,사이드,오니언링,4500,
SD005,사이드,갈릭브레드,3500,
DR001,음료,콜라 1.25L,2500,
DR002,음료,사이다 1.25L,2500,
DR003,음료,오렌지주스,3000,
DR004,음료,아이스티,2500,
```

### 옵션 목록 (src/main/resources/options.md)

```
옵션그룹,옵션코드,옵션명,추가금액,옵션타입
사이즈,SZ001,M (기본),0,필수
사이즈,SZ002,L (+3000원),3000,필수
사이즈,SZ003,XL (+6000원),6000,필수
토핑,TP001,치즈 추가,1500,선택
토핑,TP002,페퍼로니 추가,2000,선택
토핑,TP003,베이컨 추가,2000,선택
토핑,TP004,올리브 추가,1000,선택
토핑,TP005,파인애플 추가,1500,선택
소스,SC001,핫소스 추가,500,선택
소스,SC002,갈릭소스 추가,500,선택
소스,SC003,랜치소스 추가,500,선택
```

### 보유 쿠폰 목록 (src/main/resources/coupons.md)

```
쿠폰코드,쿠폰명,쿠폰타입,할인값,최소주문금액
CP001,첫 주문 3000원 할인,정액,3000,15000
CP002,10% 할인 쿠폰,정률,10,20000
CP003,배달비 무료 쿠폰,배달비무료,0,12000
CP004,5000원 할인 쿠폰,정액,5000,25000
CP005,15% 할인 쿠폰,정률,15,30000
```

- 세 파일의 내용은 수정이 가능하다. 단, 형식은 유지해야 한다.

---

## ✍🏻 입출력 요구 사항

### 기능 선택

프로그램 시작 시 환영 메시지와 기능 메뉴를 출력한다.

```
안녕하세요. 우아한 피자입니다. 🍕

기능을 선택하세요.
1. 메뉴 조회
2. 메뉴 주문
3. 장바구니 보기
4. 쿠폰 적용
5. 주문하기
Q. 종료
```

### 1. 메뉴 조회

```
[메뉴 조회]

== 피자 ==
PZ001. 페퍼로니 피자     15,000원 (사이즈 선택 필수)
PZ002. 치즈 피자         13,000원 (사이즈 선택 필수)
PZ003. 불고기 피자       16,000원 (사이즈 선택 필수)
PZ004. 슈프림 피자       18,000원 (사이즈 선택 필수)
PZ005. 하와이안 피자     16,000원 (사이즈 선택 필수)

== 사이드 ==
SD001. 치즈스틱          5,000원
SD002. 감자튀김          4,000원
SD003. 치킨윙            6,000원
SD004. 오니언링          4,500원
SD005. 갈릭브레드        3,500원

== 음료 ==
DR001. 콜라 1.25L        2,500원
DR002. 사이다 1.25L      2,500원
DR003. 오렌지주스        3,000원
DR004. 아이스티          2,500원
```

### 2. 메뉴 주문

#### 피자 주문 (필수 옵션 있음)

```
[메뉴 주문]
주문할 메뉴 코드를 입력하세요.
PZ001

=== 페퍼로니 피자 ===
기본 가격: 15,000원

[필수] 사이즈를 선택하세요.
1. M (기본) (+0원)
2. L (+3,000원)
3. XL (+6,000원)
2

[선택] 토핑을 추가하시겠습니까? (Y/N)
Y

추가할 토핑을 선택하세요. (여러 개 선택: 쉼표로 구분, 완료: 엔터)
1. 치즈 추가 (+1,500원)
2. 페퍼로니 추가 (+2,000원)
3. 베이컨 추가 (+2,000원)
4. 올리브 추가 (+1,000원)
5. 파인애플 추가 (+1,500원)
1,3

[선택] 소스를 추가하시겠습니까? (Y/N)
N

수량을 입력하세요.
2

장바구니에 추가되었습니다.
- 페퍼로니 피자 (L)
- 토핑: 치즈 추가, 베이컨 추가
- 단가: 24,500원
- 수량: 2개
- 금액: 49,000원
```

#### 사이드/음료 주문 (필수 옵션 없음)

```
[메뉴 주문]
주문할 메뉴 코드를 입력하세요.
SD001

=== 치즈스틱 ===
기본 가격: 5,000원

수량을 입력하세요.
2

장바구니에 추가되었습니다.
- 치즈스틱
- 단가: 5,000원
- 수량: 2개
- 금액: 10,000원
```

#### 주문 에러 - 필수 옵션 미선택

```
[ERROR] 사이즈는 필수로 선택해야 합니다.
```

#### 주문 에러 - 존재하지 않는 메뉴

```
[ERROR] 존재하지 않는 메뉴입니다.
```

#### 주문 에러 - 잘못된 수량

```
[ERROR] 수량은 1 이상의 숫자여야 합니다.
```

### 3. 장바구니 보기

```
[장바구니]

===================================
No  메뉴명                      금액
===================================
1   페퍼로니 피자 (L)          49,000원
    - 치즈 추가, 베이컨 추가
    - 24,500원 × 2개
-----------------------------------
2   치즈스틱                   10,000원
    - 5,000원 × 2개
===================================
총 주문 금액                   59,000원
===================================

1. 항목 삭제
2. 수량 변경
3. 돌아가기
```

#### 장바구니가 비어있는 경우

```
[장바구니]

장바구니가 비어있습니다.
```

#### 항목 삭제

```
삭제할 항목 번호를 입력하세요.
1

페퍼로니 피자 (L)이(가) 삭제되었습니다.
```

#### 수량 변경

```
수량을 변경할 항목 번호를 입력하세요.
2

현재 수량: 2개
변경할 수량을 입력하세요. (0 입력 시 삭제)
3

치즈스틱의 수량이 3개로 변경되었습니다.
```

### 4. 쿠폰 적용

```
[쿠폰 적용]

보유 쿠폰 목록
===================================
1. 첫 주문 3000원 할인
   - 3,000원 할인
   - 최소 주문 금액: 15,000원
-----------------------------------
2. 10% 할인 쿠폰
   - 10% 할인
   - 최소 주문 금액: 20,000원
-----------------------------------
3. 배달비 무료 쿠폰
   - 배달비 무료
   - 최소 주문 금액: 12,000원
-----------------------------------
4. 5000원 할인 쿠폰
   - 5,000원 할인
   - 최소 주문 금액: 25,000원
-----------------------------------
5. 15% 할인 쿠폰
   - 15% 할인
   - 최소 주문 금액: 30,000원
===================================

현재 총 주문 금액: 59,000원
현재 적용된 쿠폰: 없음

적용할 쿠폰 번호를 입력하세요. (취소: 0)
2

10% 할인 쿠폰이 적용되었습니다.
- 할인 금액: 5,900원
```

#### 쿠폰 적용 불가 - 최소 주문 금액 미달

```
적용할 쿠폰 번호를 입력하세요. (취소: 0)
5

[ERROR] 최소 주문 금액(30,000원)을 충족하지 않습니다. (현재: 15,000원)
```

#### 쿠폰 교체

```
현재 적용된 쿠폰: 10% 할인 쿠폰

적용할 쿠폰 번호를 입력하세요. (취소: 0, 적용 해제: -1)
1

기존 쿠폰(10% 할인 쿠폰)이 해제되고 새 쿠폰이 적용됩니다.
첫 주문 3000원 할인이 적용되었습니다.
- 할인 금액: 3,000원
```

#### 쿠폰이 없는 경우

```
[쿠폰 적용]

보유한 쿠폰이 없습니다.
```

### 5. 주문하기

```
[주문하기]

========== 주문 내역서 ==========

[주문 메뉴]
페퍼로니 피자 (L)              49,000원
  - 치즈 추가, 베이컨 추가
  - 24,500원 × 2개
치즈스틱                       10,000원
  - 5,000원 × 2개

=================================
총 주문 금액                   59,000원
할인 (10% 할인 쿠폰)           -5,900원
배달비                              0원
=================================
최종 결제 금액                 53,100원
=================================

주문을 완료하시겠습니까? (Y/N)
Y

주문이 완료되었습니다! 🎉
예상 도착 시간: 14:35 ~ 14:55
맛있게 드세요!
```

#### 주문 불가 - 최소 주문 금액 미달

```
[주문하기]

========== 주문 내역서 ==========

[주문 메뉴]
콜라 1.25L                      2,500원
  - 2,500원 × 1개

=================================
총 주문 금액                    2,500원
할인                                0원
배달비                          3,000원
=================================
최종 결제 금액                  5,500원
=================================

[ERROR] 최소 주문 금액(12,000원)을 충족하지 않습니다. (현재: 2,500원)
메뉴를 더 추가해 주세요.
```

#### 주문 불가 - 장바구니 비어있음

```
[주문하기]

[ERROR] 장바구니가 비어있습니다. 먼저 메뉴를 추가해 주세요.
```

### 배달비 계산 예시

#### 배달비 부과 (주문 금액 20,000원 미만)

```
=================================
총 주문 금액                   18,000원
할인                                0원
배달비                          3,000원
=================================
최종 결제 금액                 21,000원
=================================
```

#### 배달비 무료 (주문 금액 20,000원 이상)

```
=================================
총 주문 금액                   25,000원
할인                                0원
배달비                              0원
=================================
최종 결제 금액                 25,000원
=================================
```

#### 배달비 무료 (배달비 무료 쿠폰 적용)

```
=================================
총 주문 금액                   15,000원
할인 (배달비 무료 쿠폰)             0원
배달비                              0원
=================================
최종 결제 금액                 15,000원
=================================
```

### 에러 메시지

- 존재하지 않는 메뉴 코드: `[ERROR] 존재하지 않는 메뉴입니다.`
- 잘못된 수량: `[ERROR] 수량은 1 이상의 숫자여야 합니다.`
- 필수 옵션 미선택: `[ERROR] {옵션그룹}은(는) 필수로 선택해야 합니다.`
- 잘못된 옵션 번호: `[ERROR] 잘못된 옵션 번호입니다.`
- 장바구니 비어있음: `[ERROR] 장바구니가 비어있습니다.`
- 최소 주문 금액 미달: `[ERROR] 최소 주문 금액(12,000원)을 충족하지 않습니다.`
- 쿠폰 조건 미충족: `[ERROR] 최소 주문 금액({금액}원)을 충족하지 않습니다.`
- 잘못된 입력: `[ERROR] 잘못된 입력입니다. 다시 입력해 주세요.`

---

## 🎯 프로그래밍 요구 사항

### 프로그래밍 요구 사항 1

- JDK 21 버전에서 실행 가능해야 한다. **JDK 21에서 정상적으로 동작하지 않을 경우 0점 처리한다.**
- 프로그램 실행의 시작점은 `Application`의 `main()`이다.
- `build.gradle` 파일을 변경할 수 없고, 제공된 라이브러리 이외의 외부 라이브러리는 사용하지 않는다.
- 프로그램 종료 시 `System.exit()`를 호출하지 않는다.
- 프로그래밍 요구 사항에서 달리 명시하지 않는 한 파일, 패키지 등의 이름을 바꾸거나 이동하지 않는다.
- 자바 코드 컨벤션을 지키면서 프로그래밍한다.
  - 기본적으로 [Java Style Guide](https://github.com/woowacourse/woowacourse-docs/blob/main/styleguide/java)를 원칙으로 한다.

### 프로그래밍 요구 사항 2

- indent(인덴트, 들여쓰기) depth를 3이 넘지 않도록 구현한다. 2까지만 허용한다.
  - 예를 들어 while문 안에 if문이 있으면 들여쓰기는 2이다.
  - 힌트: indent(인덴트, 들여쓰기) depth를 줄이는 좋은 방법은 함수(또는 메서드)를 분리하면 된다.
- 3항 연산자를 쓰지 않는다.
- 함수(또는 메서드)가 한 가지 일만 하도록 최대한 작게 만들어라.
- JUnit 5와 AssertJ를 이용하여 정리한 기능 목록이 정상적으로 작동하는지 테스트 코드로 확인한다.
  - 테스트 도구 사용법이 익숙하지 않다면 아래 문서를 참고하여 학습한 후 테스트를 구현한다.
    - [JUnit 5 User Guide](https://junit.org/junit5/docs/current/user-guide/)
    - [AssertJ User Guide](https://assertj.github.io/doc/)
    - [AssertJ Exception Assertions](https://www.baeldung.com/assertj-exception-assertion)
    - [Guide to JUnit 5 Parameterized Tests](https://www.baeldung.com/parameterized-tests-junit-5)

### 프로그래밍 요구 사항 3

- else 예약어를 쓰지 않는다.
  - else를 쓰지 말라고 하니 switch/case로 구현하는 경우가 있는데 switch/case도 허용하지 않는다.
  - 힌트: if 조건절에서 값을 return하는 방식으로 구현하면 else를 사용하지 않아도 된다.
- Java Enum을 적용하여 프로그램을 구현한다.
- 구현한 기능에 대한 단위 테스트를 작성한다. 단, UI(System.out, System.in, Scanner) 로직은 제외한다.

### 프로그래밍 요구 사항 4

- 함수(또는 메서드)의 길이가 15라인을 넘어가지 않도록 구현한다.
  - 함수(또는 메서드)가 한 가지 일만 잘 하도록 구현한다.

### 라이브러리

- `camp.nextstep.edu.missionutils`에서 제공하는 `DateTimes`, `Randoms`, `Console` API를 사용하여 구현해야 한다.
  - 현재 날짜와 시간을 가져오려면 `camp.nextstep.edu.missionutils.DateTimes`의 `now()`를 활용한다.
  - 예상 도착 시간의 랜덤 값은 `camp.nextstep.edu.missionutils.Randoms`의 `pickNumberInRange()`를 활용한다.
  - 사용자가 입력하는 값은 `camp.nextstep.edu.missionutils.Console`의 `readLine()`을 활용한다.

---

## ✏️ 과제 진행 요구 사항

- 미션은 [java-delivery](https://github.com/woowacourse-precourse/java-delivery) 저장소를 비공개 저장소로 생성해 시작한다.
- **기능을 구현하기 전 `docs/README.md`에 구현할 기능 목록을 정리**해 추가한다.
- **Git의 커밋 단위는 앞 단계에서 `docs/README.md`에 정리한 기능 목록 단위**로 추가한다.
  - [커밋 메시지 컨벤션](https://gist.github.com/stephenparish/9941e89d80e2bc58a153) 가이드를 참고해 커밋 메시지를 작성한다.
- 과제 진행 및 제출 방법은 [프리코스 과제 제출](https://docs.google.com/document/d/1cmg0VpPkuvdaetxwp4hnyyFC_G-1f2Gr8nIDYIWcKC8/edit?usp=sharing) 문서를 참고한다.

---
